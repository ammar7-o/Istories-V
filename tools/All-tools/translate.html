<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Istories - tools Translator

    </title>
    <link rel="stylesheet" href="../../font-awesome/css/all.min.css">
    <link rel="stylesheet" href="../style.css">

    <link rel="icon" type="image/png" href="../icon.png">
    <meta property="og:title" content="Istories">
    <meta property="og:description" content="Learn Languages Through Interactive Stories.">
    <meta property="og:image" content="https://ammar7-o.github.io/Istories-V/icon.png">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ammar7-o.github.io/Istories-V/">
    <style>
        h1 {
            color: gray;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input,
        select,
        button {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .dark-mode select {
            background-color: #121212;
            color: white;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background: #45a049;
        }

        button:disabled {
            background: #cccccc;
            color: black;
            cursor: not-allowed;
        }

        .dark-mode button:disabled {
            background: #1a1a1a;
            color: rgb(206, 206, 206);
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 10px;
            border: 1px solid gray;
            border-radius: 4px;
            font-family: monospace;
            resize: vertical;
        }

        .dark-mode textarea {
            background-color: #121212;
            color: white;
        }

        .language-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        .dark-mode .status.info {
            background: #272727;
            color: #cfcfcf;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
            display: none;
        }

        .dark-mode .progress-bar {
            background: #272727;

        }

        .progress-fill {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }

        .result-section {
            margin-top: 30px;
        }

        .copy-btn {
            background: var(--primary);
            margin-left: 10px;
        }

        .copy-btn:hover {
            background: #0b7dda;
        }
    </style>
</head>

<body>
    <header id="top">
        <div class="container">
            <div class="header-content">
                <div class="left">
                    <a href="../index.html" class="logo">
                        <img src="../../icon.svg" alt="">
                        <span>IStories</span>
                    </a>
                    <nav>
                        <ul>
                            <li> <a href="#" class="nav-btn active" title="Vocabulary"><i class="fas fa-language"
                                        data-page="home"></i> </a>
                            </li>
                            <li><a href="#" title="more" id="toggle-nav"><i class="fas fa-bars"></i></a></li>
                            <div id="more" class="more">
                                <li><a href="../../index.html" class="nav-btn"><i class="fa-solid fa-home"></i> Home</a>
                                </li>
                                <li><a href="add-story.html" class="nav-btn"><i class="fas fa-search"></i>
                                        Analyzer</a>
                                </li>

                            </div>



                        </ul>
                    </nav>
                </div>
                <div class="header-actions">
                    <!--search bar-->
                    <div class="space"></div>

                </div>
            </div>
    </header>


    <div id="settings-overlay" class="settings-overlay"></div>

    <main class="main-content">
        <div class="container">
            <!-- Home Page -->
            <div id="home" class="page active">

                <div class="container">
                    <h1> CSV Translator</h1>

                    <div class="language-selector">
                        <label for="target-language">Target Language:</label>
                        <select id="target-language">
                            <option value="ar">Arabic (العربية)</option>
                            <option value="es">Spanish (Español)</option>
                            <option value="fr">French (Français)</option>
                            <option value="de">German (Deutsch)</option>
                            <option value="zh-CN">Chinese (中文)</option>
                            <option value="ja">Japanese (日本語)</option>
                            <option value="ru">Russian (Русский)</option>
                            <option value="pt">Portuguese (Português)</option>
                            <option value="it">Italian (Italiano)</option>
                            <option value="ko">Korean (한국어)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="csv-file">Choose CSV File:</label>
                        <input type="file" id="csv-file" accept=".csv">
                    </div>

                    <div class="form-group">
                        <label>Or paste CSV content:</label>
                        <textarea id="csv-content"
                            placeholder="Enter CSV data here (one word per line or comma-separated)"></textarea>
                    </div>

                    <div class="progress-bar" id="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>

                    <div class="status" id="status"></div>

                    <button id="translate-btn">Start Translation</button>
                    <button id="stop-btn" style="display: none;">Stop Translation</button>

                    <div class="result-section">
                        <h3>Translation Results (JSON format):</h3>
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <button id="copy-btn" class="copy-btn">Copy to Clipboard</button>
                            <span id="copy-status"
                                style="margin-left: 10px; color: green; display: none;">Copied!</span>
                        </div>
                        <textarea id="result" readonly></textarea>
                    </div>
                </div>
            </div>
        </div>
    </main>


    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="logo">
                    <img src="../../icon.svg" alt="">
                    <span>IStories</span>
                </div>
                <div class="footer-links">
                    <a target="_blank" href="https://ammar7-o.github.io/RAME/#">About</a>

                </div>
            </div>
        </div>
    </footer>



    <script src="../main.js"></script>

    <script>
        // Translation function from your code
        async function translateWordToLanguage(word, targetLang = null) {
            if (!targetLang) {
                targetLang = getCurrentTranslationLanguage();
            }

            try {
                const response = await fetch(
                    `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(word)}`
                );

                if (!response.ok) {
                    throw new Error('Translation API error');
                }

                const data = await response.json();

                if (data && data[0] && data[0][0] && data[0][0][0]) {
                    return data[0][0][0];
                } else {
                    throw new Error('Invalid translation response');
                }
            } catch (error) {
                console.error('Translation error:', error);
                throw error;
            }
        }

        function getCurrentTranslationLanguage() {
            return document.getElementById('target-language').value;
        }

        // DOM Elements
        const csvFileInput = document.getElementById('csv-file');
        const csvContentTextarea = document.getElementById('csv-content');
        const translateBtn = document.getElementById('translate-btn');
        const stopBtn = document.getElementById('stop-btn');
        const resultTextarea = document.getElementById('result');
        const statusDiv = document.getElementById('status');
        const progressBar = document.getElementById('progress-bar');
        const progressFill = document.getElementById('progress-fill');
        const copyBtn = document.getElementById('copy-btn');
        const copyStatus = document.getElementById('copy-status');

        // State variables
        let isTranslating = false;
        let stopTranslation = false;

        // Read CSV file
        csvFileInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    csvContentTextarea.value = event.target.result;
                };
                reader.readAsText(file);
            }
        });

        // Start translation
        translateBtn.addEventListener('click', async () => {
            if (isTranslating) return;

            const targetLang = getCurrentTranslationLanguage();
            const csvContent = csvContentTextarea.value.trim();

            if (!csvContent) {
                showStatus('Please provide CSV content or upload a file.', 'error');
                return;
            }

            // Parse CSV content
            let words = [];
            if (csvContent.includes(',')) {
                // Comma-separated values
                words = csvContent.split(',').map(w => w.trim()).filter(w => w);
            } else {
                // One word per line
                words = csvContent.split('\n').map(w => w.trim()).filter(w => w);
            }

            if (words.length === 0) {
                showStatus('No valid words found in the CSV.', 'error');
                return;
            }

            showStatus(`Found ${words.length} words to translate. Starting translation...`, 'info');

            // Reset state
            isTranslating = true;
            stopTranslation = false;
            translateBtn.disabled = true;
            stopBtn.style.display = 'inline-block';
            progressBar.style.display = 'block';

            const translations = {};
            let completed = 0;

            // Translate each word
            for (let i = 0; i < words.length; i++) {
                if (stopTranslation) {
                    showStatus('Translation stopped by user.', 'info');
                    break;
                }

                const word = words[i];

                // Skip empty words
                if (!word) continue;

                try {
                    // Add delay to avoid rate limiting (500ms between requests)
                    if (i > 0) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }

                    const translation = await translateWordToLanguage(word, targetLang);

                    // Convert word to kebab-case for keys with special characters
                    const key = word.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');

                    translations[key] = {
                        translation: translation
                    };

                    completed++;
                    const progress = Math.round((completed / words.length) * 100);
                    progressFill.style.width = `${progress}%`;

                    // Update status periodically
                    if (completed % 5 === 0 || completed === words.length) {
                        showStatus(`Translated ${completed}/${words.length} words...`, 'info');
                    }

                } catch (error) {
                    console.error(`Failed to translate "${word}":`, error);
                    // Continue with next word even if one fails
                }
            }

            // Update UI with results
            const jsonOutput = JSON.stringify(translations, null, 2);
            resultTextarea.value = jsonOutput;

            // Show completion status
            const successCount = Object.keys(translations).length;
            if (stopTranslation) {
                showStatus(`Translation stopped. Successfully translated ${successCount} words.`, 'info');
            } else {
                showStatus(`Translation completed! Successfully translated ${successCount}/${words.length} words.`, 'success');
            }

            // Reset UI state
            isTranslating = false;
            translateBtn.disabled = false;
            stopBtn.style.display = 'none';
        });

        // Stop translation
        stopBtn.addEventListener('click', () => {
            if (isTranslating) {
                stopTranslation = true;
                showStatus('Stopping translation...', 'info');
            }
        });

        // Copy to clipboard
        copyBtn.addEventListener('click', () => {
            if (resultTextarea.value) {
                resultTextarea.select();
                document.execCommand('copy');
                copyStatus.style.display = 'inline';
                setTimeout(() => {
                    copyStatus.style.display = 'none';
                }, 2000);
            }
        });

        function showStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }

        // Example CSV content
        document.addEventListener('DOMContentLoaded', () => {
            csvContentTextarea.placeholder = `Enter CSV data here (one word per line or comma-separated)
Example:
the
of
at
click-to-translate
if
hello
world
goodbye
thank you`;
        });
    </script>

</body>

</html>